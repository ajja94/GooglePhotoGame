<!DOCTYPE html>
<html>
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <!--@*<script src="../css/FrontPhotoGame.css"></script>*@-->
    <link rel="stylesheet" type="text/css" src="../css/FrontPhotoGame.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


    <style>
        /*Always set the map height explicitly to define the size of the div
            * element that contains the map.*/

        body {
            padding: 0;
            margin: 0;
        }

        div.page {
            height: 100vh;
            display: grid;
            /*kan også bruke px(pixler) istede for fr(fractions)*/
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 2fr 12fr;
            /*grid-template viser oppsett for gridden skiller horisontalt med mellomrom*/
            grid-template-areas: 'header header' 'Photo Map';
            background-image: url(https://i.pinimg.com/originals/23/13/a4/2313a4583905b1bd8bfc2811c7f02487.jpg);
        }



        div.header {
            background-color: #d1a476;
            grid-area: header;
        }

            div.header > h1 {
                color: black;
                font-size: xx-large;
                text-align-last: center;
                font-family: 'Comic Sans MS';
            }

        img {
            /*margin-left: 10%;*/
            height: 80%;
            width: 80%;
            /*border-radius: 5%;*/
        }

        div.Photo {
            height: 100%;
            width: 100%;
        }

        #Map {
            height: 80%;
            width: 80%;
        }
        /*Optional: Makes the sample page fill the window.*/
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        button {
            height: 100px;
            width: 200px;
            font-size: 35px;
            font-weight: bold;
            /*position: fixed;
            left: 40px;
            bottom: 5%;*/
            align-items: center;
        }

        .nyttSpill {
            bottom: 50%;
            left: 10%;
        }

        .tidligereSpill {
            bottom: 50%;
            right: 10%;
        }

        .highscore {
            bottom: 20%;
            position: center;
        }
    </style>
</head>
<body>


    <div id="Main"></div>


    <script>
        let gameModel = { game: null, albums: [], page: "initial" };
        let myLatlng;// = { lat: 59.0250, lng: 10.0352 };
        let ConvertedCoordinates;
        let parameter;
        //let myLatlng = { 59.0250: 10.0352 };
        var backGroundIMG;
        var map;
        var image = `<img src="https://www.ht.no/incoming/article14731252.ece/qxoh2g/ALTERNATES/w980-default/16KUL%20vinnerbildet.jpg">`;
        var frontpageBackgroundImage = `<img class="FirstBackground" src="https://i.pinimg.com/originals/23/13/a4/2313a4583905b1bd8bfc2811c7f02487.jpg">`;
        AlbumPicker();
        show();
        //GetAlbumNamesAsync();
        function show() {

            if (gameModel.page == "initial") {
                document.getElementById('Main').innerHTML =
                                                           `<div class="page">
                                                              <div class="header"><h1>Welcome to the dark side<h1></div>
                                                               <button class="nyttspill" id="NyttSpill" onclick="velgBy()">Nytt Spill</button>
                                                               <button class="tidligereSpill" id="TidligereSpill" onclick="Next()">Tidligere Spill</button>
                                                              <button class="highscore" id="HighScore" onclick="Next()">HighScore</button>
                                                            </div>`;
            }

            if (gameModel.page == "AlbumPage") {
                let alleAlbum = "";
                for (let album of gameModel.albums) {

                    alleAlbum +=
                        ` <button onclick="startGame('${album}')">${album}</button>
                                                              `;

                }
                document.getElementById('Main').innerHTML = `<div class="page">
                                                                <div class="header"><h1>Welcome to the dark side<h1></div>

                                                                            ${alleAlbum}</div>`
            }
            if (gameModel.page == "GamePage") {

                document.getElementById('Main').innerHTML =
                    `                                       <div class="page">
                                                                <div class="header"><h1>Welcome to the dark side<h1></div>
                                                                <div class="Photo"><img src="${gameModel.game.photoUrl}"></div>
                                                                <div id="Map"></div>  <button onclick="play(myLatlng)">Godkjenn posisjon</button>
                                                                <button id="NextPhoto" onclick="Next()">neste</button>
                                                            </div>`;
                initMap();
            }
            if (gameModel.page == "ScorePage") {
                document.getElementById('Main').innerHTML = `<div class="page">
                                                                 <div class="header"><h1>Welcome to the dark side<h1></div>
                                                                 <div class="Photo">${score}</div>
                                                                 <div id="Map"></div>  
                                                                 <button id="NextPhoto" onclick="Next()">neste</button>
                                                             </div>`;
                initMap();
            }


        }


        //<button onclick="startGame()">Start</button>
        //console.log(gameModel.poeng, gameModel.id);


        function velgBy() {
            gameModel.page = "AlbumPage";
            show();
        }



        function initMap() {
            //myLatlng = { 59.0250: 10.0352 }
            myLatlng = { lat: 59.0250, lng: 10.0352 }

            map = new google.maps.Map(document.getElementById('Map'),
                {
                    center: myLatlng,
                    zoom: 12
                });

            // Create the initial InfoWindow.
            let infoWindow = new google.maps.InfoWindow(
                { content: 'Click the map to get Lat/Lng!', position: myLatlng });
            infoWindow.open(map);

            // Configure the click listener.
            map.addListener('click', function (mapsMouseEvent) {
                // Close the current InfoWindow.
                infoWindow.close();

                // Create a new InfoWindow.
                infoWindow = new google.maps.InfoWindow({ position: mapsMouseEvent.latLng });
                
                infoWindow.setContent(mapsMouseEvent.latLng.toString());
                myLatlng =  mapsMouseEvent.latLng.toString();
                infoWindow.open(map);
               
            });
            return myLatlng;
        }

        async function startGame(album) {
            let response = await axios.get(`/api/Game/${album}`);
            gameModel.game = response.data;
            console.log(gameModel);
            gameModel.page = "GamePage";
            show();
        }

        async function AlbumPicker() {

            let response = await axios.get('/api/Album');
            gameModel.albums = response.data;
            show();
        }
        async function AlbumChoice() {
            spillValgt = true
        }
        
        async function readGame(gameId) {
            let response = await axios.get('/api/Game/' + gameId);
            gameModel = response.data;
            console.log(gameModel);
            show();
        }


        //function setTimer() {
        //    var seconds = gameModel.gameTimer;
        //    var minutes = 0;
        //    while (seconds > 59) {
        //        seconds -= 60;
        //        minutes++;
        //    }
        //    if (seconds <= 9) seconds = "0" + seconds;
        //    if (minutes <= 9) minutes = "0" + minutes;
        //    document.getElementById('SetTimer').innerHTML = `${minutes}:${seconds}`;
        //    gameModel.gameTimer++;
        //}
        //"gameCoordinates": gameModel.coordinates,
        async function ShowScore(){
            let response = await axios.get('/api/Game');
            gameModel.Poeng = response.data;

        }
        // "gameId": gameModel.Id, 
        async function play(myLatlng) {
        convertToDoubleCoordinates(myLatlng);
            const paramObj = {"gameId": gameModel.game.id, "coordinates": parameter };
            console.log(paramObj);
            let response = await axios.put('/api/Game', paramObj);
            gameModel = response.data;
            console.log(gameModel);
            gameModel.page = "ScorePage";
            ShowScore();
            show();
        }

        function Next() {
            var notYet = "not yet implemented";
            console.log(notYet);
            
        }
        function convertToDoubleCoordinates(myLatlng){
        
            ConvertedCoordinates = myLatlng.replace('(','').replace(')','').split(',');
            parameter = {Lat: ConvertedCoordinates[0], Long: ConvertedCoordinates[1]};
            //parcefloat("parameter"); se på det her imorgen
            return true;
        }
        

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3-7xZ-x5C3tP5N9_kJmraYFQ8MF508lI&callback=initMap" async defer></script>

</body>
</html>